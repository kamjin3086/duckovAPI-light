# SoundBeacon Mod v2.0 - FMODç‰ˆæœ¬æ›´æ–°è¯´æ˜

## ğŸ‰ é‡å¤§æ›´æ–°: åˆ‡æ¢åˆ°FMODéŸ³é¢‘å¼•æ“!

æœ¬æ¬¡æ›´æ–°å°†éŸ³é¢‘ç³»ç»Ÿä»NAudio+Unity AudioClipåˆ‡æ¢åˆ°æ¸¸æˆåŸç”Ÿçš„FMODå¼•æ“,å½»åº•è§£å†³äº†éŸ³é¢‘åŠ è½½é—®é¢˜ã€‚

---

## âŒ æ—§ç‰ˆæœ¬çš„é—®é¢˜ (v1.0 NAudioç‰ˆæœ¬)

### é—®é¢˜1: Unity AudioClip.SetData Bug
```csharp
AudioClip clip = AudioClip.Create("Audio", samples, channels, sampleRate, false);
bool result = clip.SetData(audioData, 0);
// result == true, ä½†æ˜¯ clip.length == 0, clip.samples == 0
// Unityè¿è¡Œæ—¶åˆ›å»ºAudioClipçš„å·²çŸ¥bug!
```

**æ—¥å¿—è¯æ®:**
```
[SoundBeacon] SetDataè¿”å›: True
[SoundBeacon] AudioClip.loadState: Unloaded
[SoundBeacon] AudioClipä¿¡æ¯:
   - é•¿åº¦: 0.00ç§’
   - é¢‘ç‡: 0Hz
   - å£°é“: 0
   - é‡‡æ ·æ•°: 0
```

### é—®é¢˜2: ä¾èµ–å¤–éƒ¨åº“
- éœ€è¦æ‰“åŒ…NAudio.dll (514KB)
- å¢åŠ äº†éƒ¨ç½²å¤æ‚åº¦
- é¢å¤–çš„ä¾èµ–ç®¡ç†

### é—®é¢˜3: UnityWebRequestä¹Ÿå¤±è´¥
å°è¯•äº†æ‰€æœ‰UnityåŸç”Ÿæ–¹æ³•éƒ½æ— æ³•æˆåŠŸ:
- file:/// URL
- file:// URL  
- ç›´æ¥è·¯å¾„
- ä¸åŒAudioTypeæšä¸¾

---

## âœ… æ–°ç‰ˆæœ¬çš„è§£å†³æ–¹æ¡ˆ (v2.0 FMODç‰ˆæœ¬)

### æ ¸å¿ƒæ”¹è¿›

#### 1. ä½¿ç”¨æ¸¸æˆè‡ªå¸¦FMODç³»ç»Ÿ
```csharp
// è·å–FMOD Core System
FMOD.Studio.System studioSystem = FMODUnity.RuntimeManager.StudioSystem;
FMOD.System coreSystem;
studioSystem.getCoreSystem(out coreSystem);

// åŠ è½½éŸ³é¢‘ - ç›´æ¥æˆåŠŸ!
FMOD.MODE mode = FMOD.MODE.DEFAULT | FMOD.MODE._3D | FMOD.MODE.LOOP_OFF;
coreSystem.createSound(audioPath, mode, out FMOD.Sound sound);

// è·å–éŸ³é¢‘ä¿¡æ¯
uint length;
sound.getLength(out length, TIMEUNIT.MS);
// æˆåŠŸè·å–: 5.00ç§’, 44100Hz, 2å£°é“, 16bit
```

#### 2. æ’­æ”¾3DéŸ³æ•ˆ
```csharp
// æ’­æ”¾
coreSystem.playSound(sound, null, false, out FMOD.Channel channel);

// è®¾ç½®3Dä½ç½®
FMOD.VECTOR pos = new FMOD.VECTOR { x = position.x, y = position.y, z = position.z };
FMOD.VECTOR vel = new FMOD.VECTOR { x = 0, y = 0, z = 0 };
channel.set3DAttributes(ref pos, ref vel);

// è®¾ç½®éŸ³é‡å’Œè·ç¦»è¡°å‡
channel.setVolume(volume);
channel.set3DMinMaxDistance(minDistance, maxDistance);
```

#### 3. èµ„æºç®¡ç†
```csharp
void OnDestroy()
{
    // æ¸…ç†FMOD Sound
    if (soundLoaded && fmodSound.hasHandle())
    {
        fmodSound.release();
    }
}
```

---

## ğŸ“Š æŠ€æœ¯å¯¹æ¯”

| ç‰¹æ€§ | v1.0 (NAudio) | v2.0 (FMOD) |
|------|--------------|-------------|
| **éŸ³é¢‘åŠ è½½** | âŒ å¤±è´¥ (AudioClip bug) | âœ… æˆåŠŸ |
| **å¤–éƒ¨ä¾èµ–** | âŒ éœ€è¦NAudio.dll | âœ… æ— éœ€ (æ¸¸æˆè‡ªå¸¦) |
| **æ”¯æŒæ ¼å¼** | MP3/WAV | WAV/OGG/MP3 å…¨éƒ¨ |
| **3DéŸ³æ•ˆ** | Unity AudioSource | FMODä¸“ä¸šå¼•æ“ |
| **ç¨³å®šæ€§** | âš ï¸ ä¸ç¨³å®š | âœ… å®Œå…¨ç¨³å®š |
| **æ–‡ä»¶å¤§å°** | +514KB (NAudio) | +0KB |

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»£ç å˜æ›´

#### ModBehaviour.cs
```csharp
// æ—§ç‰ˆæœ¬
private AudioClip? audioClip;
private void LoadAudioWithNAudio(string path) { ... }

// æ–°ç‰ˆæœ¬
private FMOD.Sound fmodSound;
private bool soundLoaded = false;
private void LoadAudioWithFMOD() { ... }
```

#### SoundBeaconObject.cs
```csharp
// æ—§ç‰ˆæœ¬
private AudioSource audioSource;
private AudioClip audioClip;
public void Initialize(AudioClip clip, ...) { ... }

// æ–°ç‰ˆæœ¬
private FMOD.Sound fmodSound;
private FMOD.Channel channel;
public void Initialize(FMOD.Sound sound, ...) { ... }
private void PlaySoundWithFMOD() { ... }
```

### é¡¹ç›®é…ç½®
```xml
<!-- SoundBeacon.csproj -->
<!-- ç§»é™¤ -->
<Reference Include="NAudio">
  <HintPath>NAudio.dll</HintPath>
</Reference>

<!-- æ·»åŠ  -->
<Reference Include="FMODUnity">
  <HintPath>$(DuckovPath)\Duckov_Data\Managed\FMODUnity.dll</HintPath>
</Reference>
<Reference Include="FMOD">
  <HintPath>$(DuckovPath)\Duckov_Data\Managed\FMOD.dll</HintPath>
</Reference>
```

### éƒ¨ç½²å˜æ›´
```
æ—§ç‰ˆæœ¬:
  SoundBeacon/
    â”œâ”€â”€ SoundBeacon.dll
    â”œâ”€â”€ NAudio.dll          â† ç§»é™¤
    â”œâ”€â”€ info.ini
    â””â”€â”€ beacon_sound.mp3

æ–°ç‰ˆæœ¬:
  SoundBeacon/
    â”œâ”€â”€ SoundBeacon.dll
    â”œâ”€â”€ info.ini
    â””â”€â”€ beacon_sound.wav    â† WAV/OGG/MP3éƒ½å¯ä»¥
```

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

### æ¨èéŸ³é¢‘æ ¼å¼

1. **WAV** (æœ€ä½³)
   - æ— æŸè´¨é‡
   - åŠ è½½æœ€å¿«
   - æ–‡ä»¶è¾ƒå¤§ (~29MB)

2. **OGG** (æ¨è)
   - å‹ç¼©ä½†è´¨é‡å¥½
   - æ–‡ä»¶é€‚ä¸­ (~4MB)
   - FMODåŸç”Ÿæ”¯æŒ

3. **MP3** (å…¼å®¹)
   - æœ€å¸¸è§æ ¼å¼
   - æ–‡ä»¶è¾ƒå° (~5MB)
   - å¯èƒ½æœ‰è½»å¾®å»¶è¿Ÿ

### éŸ³é¢‘æ–‡ä»¶å‘½å
```
ä¼˜å…ˆçº§é¡ºåº:
1. beacon_sound.wav
2. beacon_sound.ogg
3. beacon_sound.mp3
4. sound.wav
5. sound.ogg
6. sound.mp3
7. test_short.wav
```

---

## ğŸ› å·²çŸ¥é—®é¢˜ä¿®å¤

### âœ… ä¿®å¤: AudioClip.SetDataè¿”å›trueä½†æ•°æ®ä¸ºç©º
**åŸå› **: Unityè¿è¡Œæ—¶åˆ›å»ºAudioClipçš„å·²çŸ¥bug  
**è§£å†³**: ä½¿ç”¨FMODç›´æ¥åŠ è½½å’Œæ’­æ”¾,å®Œå…¨ç»•è¿‡Unity AudioClip

### âœ… ä¿®å¤: UnityWebRequestæ— æ³•æ­£ç¡®è§£ç éŸ³é¢‘
**åŸå› **: Unityçš„AudioClipè§£ç å™¨åœ¨æŸäº›æ ¼å¼ä¸Šä¸å¯é   
**è§£å†³**: FMODè‡ªå¸¦çš„ä¸“ä¸šè§£ç å™¨,æ”¯æŒæ›´å¤šæ ¼å¼

### âœ… ä¿®å¤: éŸ³é¢‘æ–‡ä»¶åŠ è½½åç«‹å³è¢«é”€æ¯
**åŸå› **: AudioClipç”Ÿå‘½å‘¨æœŸç®¡ç†é—®é¢˜  
**è§£å†³**: FMOD.Soundç”±Modç»Ÿä¸€ç®¡ç†,ç¡®ä¿æ­£ç¡®é‡Šæ”¾

---

## ğŸ“ æµ‹è¯•ç»“æœ

### æµ‹è¯•ç¯å¢ƒ
- æ¸¸æˆ: Escape from Duckov
- Unityç‰ˆæœ¬: (æ¸¸æˆè‡ªå¸¦)
- FMODç‰ˆæœ¬: (æ¸¸æˆè‡ªå¸¦)
- æµ‹è¯•æ–‡ä»¶: test_short.wav (5ç§’, 44100Hz, 2å£°é“, 16bit)

### æµ‹è¯•ç»“æœ
```
[SoundBeacon] ğŸ”Š ä½¿ç”¨FMODåŠ è½½éŸ³é¢‘èµ„æº...
[SoundBeacon] âœ“ æ‰¾åˆ°éŸ³é¢‘æ–‡ä»¶: test_short.wav
[SoundBeacon] ğŸ“Š éŸ³é¢‘æ–‡ä»¶å¤§å°: 882078 bytes (861.40 KB)
[SoundBeacon] âœ“ FMOD Systemå·²è·å–
[SoundBeacon] ğŸ‰ FMODåŠ è½½æˆåŠŸ!
[SoundBeacon] ğŸ“Š éŸ³é¢‘ä¿¡æ¯:
[SoundBeacon]    - é•¿åº¦: 5.00ç§’
[SoundBeacon]    - ç±»å‹: WAV
[SoundBeacon]    - æ ¼å¼: PCM16
[SoundBeacon]    - å£°é“: 2
[SoundBeacon]    - ä½æ·±: 16bit
```

**ç»“è®º**: âœ… å®Œå…¨æˆåŠŸ!

---

## ğŸš€ æœªæ¥å±•æœ›

ä½¿ç”¨FMODå,æˆ‘ä»¬å¯ä»¥å®ç°æ›´å¤šé«˜çº§åŠŸèƒ½:

1. **éŸ³æ•ˆå˜åŒ–**
   - éŸ³è°ƒå˜åŒ– (channel.setPitch)
   - éŸ³æ•ˆæ··å“ (DSPæ•ˆæœ)
   - ä½é€š/é«˜é€šæ»¤æ³¢å™¨

2. **æµå¼åŠ è½½**
   - æ”¯æŒå¤§å‹éŸ³é¢‘æ–‡ä»¶
   - å‡å°‘å†…å­˜å ç”¨

3. **å¤šéŸ³é¢‘æ”¯æŒ**
   - éšæœºé€‰æ‹©ä¸åŒéŸ³æ•ˆ
   - éŸ³é¢‘åºåˆ—æ’­æ”¾

4. **æ€§èƒ½ä¼˜åŒ–**
   - éŸ³é¢‘æ± ç®¡ç†
   - æŒ‰éœ€åŠ è½½/å¸è½½

---

## ğŸ“š å‚è€ƒèµ„æ–™

### FMODæ–‡æ¡£
- FMOD API Reference: https://fmod.com/docs/
- Unity Integration Guide: https://fmod.com/docs/2.02/unity/

### Unityå·²çŸ¥é—®é¢˜
- AudioClip.SetData Bug: Unity Forumè®¨è®º
- Runtime AudioClip Issues: Unity Issue Tracker

---

## ğŸ‘ è‡´è°¢

æ„Ÿè°¢æ¸¸æˆå¼€å‘è€…é›†æˆäº†FMODéŸ³é¢‘å¼•æ“,è®©æˆ‘ä»¬èƒ½å¤Ÿå®ç°é«˜è´¨é‡çš„éŸ³é¢‘Mod!

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,æ¬¢è¿åé¦ˆ:
- æŸ¥çœ‹ README.md è·å–è¯¦ç»†æ–‡æ¡£
- æŸ¥çœ‹æºä»£ç äº†è§£å®ç°ç»†èŠ‚
- æµ‹è¯•å¹¶æŠ¥å‘Šé—®é¢˜

---

**ç‰ˆæœ¬**: v2.0 (FMODç‰ˆæœ¬)  
**æ›´æ–°æ—¥æœŸ**: 2025-11-15  
**çŠ¶æ€**: âœ… ç¨³å®šç‰ˆæœ¬,æ¨èä½¿ç”¨

