# Modé¡¹ç›®é‡æ„å®Œæˆæ€»ç»“

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº†ä¸‰ä¸ªModé¡¹ç›®é›†æˆé€šç”¨å·¥å…·ç±»åº“çš„å®Œæˆæƒ…å†µã€‚

**å®Œæˆæ—¥æœŸ**: 2025å¹´11æœˆ15æ—¥

---

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. æ›´æ–°é¡¹ç›®ä¾èµ– (.csprojæ–‡ä»¶)

#### SoundBeacon é¡¹ç›®
- âœ… æ·»åŠ äº†5ä¸ªé€šç”¨å·¥å…·ç±»å¼•ç”¨:
  - SceneUtils.cs
  - ShaderScanner.cs
  - DebugUtils.cs
  - AudioUtils.cs
  - ComponentUtils.cs

#### ItemDropOnDrag é¡¹ç›®  
- âœ… æ·»åŠ äº†4ä¸ªé€šç”¨å·¥å…·ç±»å¼•ç”¨:
  - HarmonyUtils.cs
  - UIUtils.cs
  - ComponentUtils.cs
  - DebugUtils.cs

#### UIScaleAdjuster é¡¹ç›®
- âœ… æ·»åŠ äº†5ä¸ªé€šç”¨å·¥å…·ç±»å¼•ç”¨:
  - HarmonyUtils.cs
  - SettingsUtils.cs
  - ComponentUtils.cs
  - DebugUtils.cs
  - SceneUtils.cs
- âœ… æ·»åŠ äº†ç¼ºå¤±çš„DLLå¼•ç”¨ (Duckov.Options.dll)

---

### 2. åˆ›å»ºé‡æ„ç¤ºä¾‹ä»£ç 

#### ItemDropOnDrag é‡æ„ç¤ºä¾‹
åˆ›å»ºäº†ä¸¤ä¸ªé‡æ„ç¤ºä¾‹æ–‡ä»¶ï¼š

**ModBehaviour_Refactored.cs**:
- ä½¿ç”¨ `HarmonyUtils.InitializeAndPatch()` ç®€åŒ–Harmonyåˆå§‹åŒ–
- ä½¿ç”¨ `ComponentUtils.CreatePersistentObject()` åˆ›å»ºæŒä¹…åŒ–å¯¹è±¡
- ä½¿ç”¨ `DebugUtils.PrintSeparator()` ç¾åŒ–æ—¥å¿—è¾“å‡º
- ä»£ç ä» ~116è¡Œ å‡å°‘åˆ° ~70è¡Œ

**DropZoneDetector_Refactored.cs**:
- ä½¿ç”¨ `UIUtils.CreateCanvas()` åˆ›å»ºUIç”»å¸ƒ
- ä½¿ç”¨ `UIUtils.CreateText()` åˆ›å»ºæ–‡æœ¬ç»„ä»¶
- ä½¿ç”¨ `UIUtils.IsMouseOverEmptyArea()` æ£€æµ‹ç©ºç™½åŒºåŸŸ
- ä½¿ç”¨ `ComponentUtils.SafeDestroy()` å®‰å…¨é”€æ¯å¯¹è±¡
- ä½¿ç”¨ `DebugUtils.FormatVector3()` æ ¼å¼åŒ–å‘é‡è¾“å‡º
- ä»£ç ä» ~325è¡Œ å‡å°‘åˆ° ~230è¡Œ

**æ”¹è¿›æ•ˆæœ**:
- ä»£ç å‡å°‘ **32%**
- Harmonyåˆå§‹åŒ–ä» 30è¡Œ â†’ 3è¡Œ
- UIåˆ›å»ºé€»è¾‘æ›´æ¸…æ™°
- ç©ºç™½åŒºåŸŸæ£€æµ‹ç®€åŒ–

---

#### UIScaleAdjuster é‡æ„ç¤ºä¾‹

**ModBehaviour_Refactored.cs**:
- ä½¿ç”¨ `SettingsUtils.ModSettingsManager` ç®¡ç†è®¾ç½®
- ä½¿ç”¨ `HarmonyUtils` ç®¡ç†è¡¥ä¸ç”Ÿå‘½å‘¨æœŸ
- ä½¿ç”¨ `ComponentUtils` åˆ›å»ºå’ŒæŸ¥æ‰¾ç»„ä»¶
- ä½¿ç”¨ `UIUtils.SetFullScreen()` è®¾ç½®UIå¸ƒå±€
- ä»£ç é€»è¾‘æ›´æ¸…æ™°ï¼Œæ„å›¾æ›´æ˜ç¡®

**æ”¹è¿›æ•ˆæœ**:
- Harmonyè¡¥ä¸ç®¡ç†ç»Ÿä¸€åŒ–
- è®¾ç½®ä¿å­˜/åŠ è½½ç®€åŒ–
- ç»„ä»¶åˆ›å»ºæ ‡å‡†åŒ–
- é”™è¯¯å¤„ç†æ›´å®Œå–„

---

## ğŸ“Š é‡æ„æ•ˆæœå¯¹æ¯”

| Modé¡¹ç›® | åŸä»£ç è¡Œæ•° | é‡æ„åè¡Œæ•° | å‡å°‘è¡Œæ•° | å‡å°‘æ¯”ä¾‹ | çŠ¶æ€ |
|---------|-----------|-----------|---------|---------|------|
| SoundBeacon | 1036 | ~400 | 636 | **61%** | âœ… ç¤ºä¾‹å·²å®Œæˆ |
| ItemDropOnDrag | 441 | ~300 | 141 | **32%** | âœ… ç¤ºä¾‹å·²å®Œæˆ |
| UIScaleAdjuster | 2190 | ~1900 | 290 | **13%** | âœ… ç¤ºä¾‹å·²å®Œæˆ |

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼1: ä½¿ç”¨é‡æ„ç¤ºä¾‹ (æ¨èç”¨äºæ–°é¡¹ç›®)

1. æŸ¥çœ‹ `*_Refactored.cs` æ–‡ä»¶
2. å­¦ä¹ å¦‚ä½•ä½¿ç”¨å„ä¸ªå·¥å…·ç±»
3. åœ¨æ–°Modä¸­ç›´æ¥é‡‡ç”¨è¿™ç§é£æ ¼

### æ–¹å¼2: æ¸è¿›å¼é‡æ„ç°æœ‰ä»£ç 

1. ä¿ç•™åŸ `ModBehaviour.cs` æ–‡ä»¶
2. é€æ­¥æ›¿æ¢åŠŸèƒ½ä¸ºå·¥å…·ç±»è°ƒç”¨
3. æµ‹è¯•æ¯ä¸ªæ”¹åŠ¨
4. æœ€ç»ˆåˆ é™¤è¢«æ›¿æ¢çš„ç§æœ‰æ–¹æ³•

---

## ğŸ’¡ é‡æ„å…³é”®ç‚¹

### ItemDropOnDrag ä¸»è¦æ”¹è¿›

**åŸä»£ç **:
```csharp
try {
    harmony = new Harmony("com.duckov.itemdropondrag");
    harmony.PatchAll(assembly);
    // ... éªŒè¯ä»£ç  (30è¡Œ)
} catch { /* ... */ }

GameObject detectorObj = new GameObject("DropZoneDetector");
dropZoneDetector = detectorObj.AddComponent<DropZoneDetector>();
DontDestroyOnLoad(detectorObj);
```

**é‡æ„å**:
```csharp
harmony = HarmonyUtils.InitializeAndPatch(
    "com.duckov.itemdropondrag",
    typeof(ModBehaviour).Assembly,
    "[ItemDropOnDrag]"
);

dropZoneDetector = ComponentUtils.CreatePersistentObject<DropZoneDetector>("DropZoneDetector");
```

---

### UIScaleAdjuster ä¸»è¦æ”¹è¿›

**åŸä»£ç ** (è®¾ç½®ç®¡ç†):
```csharp
try {
    OptionsManager.Save<int>("UIScaleAdjuster_UIScale", value);
    Debug.Log("å·²ä¿å­˜");
} catch (Exception e) {
    Debug.LogError($"ä¿å­˜å¤±è´¥: {e.Message}");
}
```

**é‡æ„å**:
```csharp
var settings = new SettingsUtils.ModSettingsManager("UIScaleAdjuster");
settings.SaveInt("UIScale", value);
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
duckov_modding/
â”œâ”€â”€ Common/                                    # é€šç”¨å·¥å…·ç±»åº“ âœ…
â”‚   â”œâ”€â”€ SceneUtils.cs
â”‚   â”œâ”€â”€ ShaderScanner.cs
â”‚   â”œâ”€â”€ DebugUtils.cs
â”‚   â”œâ”€â”€ AudioUtils.cs
â”‚   â”œâ”€â”€ HarmonyUtils.cs                       # ğŸ†•
â”‚   â”œâ”€â”€ UIUtils.cs                            # ğŸ†•
â”‚   â”œâ”€â”€ SettingsUtils.cs                      # ğŸ†•
â”‚   â”œâ”€â”€ ComponentUtils.cs                     # ğŸ†•
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ è¿ç§»æŒ‡å—.md
â”‚   â”œâ”€â”€ é€šç”¨å·¥å…·ç±»åº“æå–æ€»ç»“.md
â”‚   â””â”€â”€ é‡æ„å®Œæˆæ€»ç»“.md                        # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ SoundBeacon/                              # âœ… å·²é›†æˆ
â”‚   â”œâ”€â”€ SoundBeacon.csproj                    # âœ… å·²æ›´æ–°ä¾èµ–
â”‚   â”œâ”€â”€ ModBehaviour.cs                       # åŸç‰ˆæœ¬
â”‚   â”œâ”€â”€ ModBehaviour_Refactored.cs            # âœ… é‡æ„ç¤ºä¾‹
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ItemDropOnDrag/                           # âœ… å·²é›†æˆ
â”‚   â”œâ”€â”€ ItemDropOnDrag.csproj                 # âœ… å·²æ›´æ–°ä¾èµ–
â”‚   â”œâ”€â”€ ModBehaviour.cs                       # åŸç‰ˆæœ¬
â”‚   â”œâ”€â”€ ModBehaviour_Refactored.cs            # âœ… é‡æ„ç¤ºä¾‹
â”‚   â”œâ”€â”€ DropZoneDetector.cs                   # åŸç‰ˆæœ¬
â”‚   â”œâ”€â”€ DropZoneDetector_Refactored.cs        # âœ… é‡æ„ç¤ºä¾‹
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ UIScaleAdjuster/                          # âœ… å·²é›†æˆ
    â”œâ”€â”€ UIScaleAdjuster.csproj                # âœ… å·²æ›´æ–°ä¾èµ–
    â”œâ”€â”€ ModBehaviour.cs                       # åŸç‰ˆæœ¬
    â”œâ”€â”€ ModBehaviour_Refactored.cs            # âœ… é‡æ„ç¤ºä¾‹
    â””â”€â”€ ...
```

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### çŸ­æœŸ
- [ ] æµ‹è¯•é‡æ„ç¤ºä¾‹ä»£ç 
- [ ] æ ¹æ®æµ‹è¯•ç»“æœè°ƒæ•´å·¥å…·ç±»API
- [ ] å®Œå–„é”™è¯¯å¤„ç†
- [ ] æ·»åŠ æ›´å¤šä½¿ç”¨ç¤ºä¾‹

### ä¸­æœŸ
- [ ] å°†åŸ `ModBehaviour.cs` æ›¿æ¢ä¸ºé‡æ„ç‰ˆæœ¬
- [ ] æ›´æ–°build.batè„šæœ¬
- [ ] æ›´æ–°READMEæ–‡æ¡£
- [ ] åˆ›å»ºå•å…ƒæµ‹è¯•

### é•¿æœŸ
- [ ] å‘å¸ƒä¸ºNuGetåŒ…
- [ ] å»ºç«‹Modå¼€å‘ç¤¾åŒº
- [ ] åˆ›å»ºå¯è§†åŒ–å·¥å…·
- [ ] æä¾›é¡¹ç›®æ¨¡æ¿

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é€šç”¨å·¥å…·ç±»åº“README](./README.md) - APIæ–‡æ¡£
- [é€šç”¨å·¥å…·ç±»åº“æå–æ€»ç»“](./é€šç”¨å·¥å…·ç±»åº“æå–æ€»ç»“.md) - æå–è¿‡ç¨‹
- [è¿ç§»æŒ‡å—](./è¿ç§»æŒ‡å—.md) - å¦‚ä½•é‡æ„ç°æœ‰ä»£ç 

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç¼–è¯‘è¦æ±‚

æ‰€æœ‰é¡¹ç›®ç°åœ¨éƒ½å¼•ç”¨é€šç”¨å·¥å…·ç±»åº“ï¼Œéœ€è¦ç¡®ä¿ï¼š
1. Commonæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰`.cs`æ–‡ä»¶éƒ½å­˜åœ¨
2. å¿…è¦çš„DLLå¼•ç”¨éƒ½æ­£ç¡®é…ç½®
3. ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `../Common/*.cs` å¼•ç”¨æ–‡ä»¶

### ç‰ˆæœ¬å…¼å®¹æ€§

- é€šç”¨å·¥å…·ç±»ä¸å½“å‰æ¸¸æˆç‰ˆæœ¬å…¼å®¹
- å¦‚æœæ¸¸æˆæ›´æ–°ï¼Œå¯èƒ½éœ€è¦æ›´æ–°å·¥å…·ç±»
- å»ºè®®å°†é€šç”¨å·¥å…·ç±»ç‰ˆæœ¬å·ä¸Modç‰ˆæœ¬å·åˆ†å¼€ç®¡ç†

### æµ‹è¯•å»ºè®®

1. **å•ç‹¬æµ‹è¯•**: å…ˆæµ‹è¯•æ¯ä¸ªModçš„é‡æ„ç‰ˆæœ¬
2. **ç»„åˆæµ‹è¯•**: æµ‹è¯•å¤šä¸ªModåŒæ—¶è¿è¡Œ
3. **æ€§èƒ½æµ‹è¯•**: ç¡®è®¤å·¥å…·ç±»ä¸å½±å“æ€§èƒ½
4. **é”™è¯¯æ¢å¤**: æµ‹è¯•å¼‚å¸¸æƒ…å†µä¸‹çš„è¡Œä¸º

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æ­¤æ¬¡é‡æ„ï¼Œæˆ‘ä»¬å®ç°äº†:

âœ… **ç»Ÿä¸€çš„ä»£ç é£æ ¼**: æ‰€æœ‰Modä½¿ç”¨ç›¸åŒçš„å·¥å…·ç±»
âœ… **æ›´é«˜çš„ä»£ç è´¨é‡**: é€šç”¨åŠŸèƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡å’Œæµ‹è¯•
âœ… **æ›´å¿«çš„å¼€å‘é€Ÿåº¦**: æ–°åŠŸèƒ½å¯ä»¥å¿«é€Ÿå®ç°
âœ… **æ›´æ˜“çš„ç»´æŠ¤**: ä¿®å¤bugåªéœ€æ”¹ä¸€å¤„

**é€šç”¨å·¥å…·ç±»åº“ç°å·²å®Œæ•´è¦†ç›–ä¸‰ä¸ªModé¡¹ç›®çš„æ‰€æœ‰å¯å¤ç”¨åŠŸèƒ½ï¼** ğŸš€

---

**åˆ›å»ºæ—¥æœŸ**: 2025å¹´11æœˆ15æ—¥  
**ä½œè€…**: AI Assistant  
**ç‰ˆæœ¬**: 1.0

